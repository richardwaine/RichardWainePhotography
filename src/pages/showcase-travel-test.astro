---
// @ts-nocheck
// TEST PAGE: Showcase Container Travel Animation (Hero â†’ Problem)

import MainLayout from '../layouts/MainLayout.astro';
import Hero from '../components/Hero.astro';
import { Image } from 'astro:assets';
import image0090 from '../assets/images/problem/Headshot_20250917_Sonya Lilienstein_Richard Waine_Lancaster_PA_0090 (horizontal) - compressed.jpg';
import image0056 from '../assets/images/problem/Headshot_20250917_Sonya Lilienstein_Richard Waine_Lancaster_PA_0056 (horizontal) - compressed.jpg';
import image0079 from '../assets/images/problem/Headshot_20250917_Sonya Lilienstein_Richard Waine_Lancaster_PA_0079 (horizontal) - compressed.jpg';

const title = 'Showcase Travel Test';

// Hero section content (duplicated from index.astro)
const heroContent = {
  title: ["WORLD CLASS", "HEADSHOT", "EXPERIENCE"],
  subtitle: "Beyond photography. We craft your professional presence with cinematic precision, luxury service, and results that open doors.",
  primaryButtonText: "GET PRICING",
  secondaryButtonText: "SCHEDULE CONSULTATION",
  heroImages: [
    '/src/assets/images/hero-images/Ken Giglio (16 x 9) - compressed.jpg',
    '/src/assets/images/hero-images/Cindy Nguyen (16 x 9) - compressed.jpg'
  ]
};
---

<MainLayout title={title}>

	<Hero
		title={heroContent.title}
		subtitle={heroContent.subtitle}
		primaryButtonText={heroContent.primaryButtonText}
		secondaryButtonText={heroContent.secondaryButtonText}
		heroImages={heroContent.heroImages}
	/>

	<!-- SVG clipPaths for triptych -->
	<svg width="0" height="0" style="position: absolute;">
		<defs>
			<clipPath id="clip-left" clipPathUnits="objectBoundingBox">
				<polygon points="0,0 1,0 0.85,1 0,1"/>
			</clipPath>
			<clipPath id="clip-center" clipPathUnits="objectBoundingBox">
				<polygon points="0.15,0 1,0 0.85,1 0,1"/>
			</clipPath>
			<clipPath id="clip-right" clipPathUnits="objectBoundingBox">
				<polygon points="0.15,0 1,0 1,1 0,1"/>
			</clipPath>
		</defs>
	</svg>

	<!-- Pre-create triptych content (hidden initially, will be inserted into showcase-container) -->
	<div id="triptych-content" style="display: none;">
		<div class="triptych-container">
			<div class="triptych-panel panel-left">
				<Image src={image0090} alt="" class="diagonal-img" />
				<div class="panel-overlay"></div>
			</div>
			<div class="triptych-panel panel-center">
				<Image src={image0056} alt="" class="diagonal-img" />
				<div class="panel-overlay"></div>
			</div>
			<div class="triptych-panel panel-right">
				<Image src={image0079} alt="" class="diagonal-img" />
				<div class="panel-overlay"></div>
			</div>
		</div>
	</div>

	<!-- Problem section - NO images visible, only text -->
	<section id="problem">
		<div class="problem-content">
			<div class="showcase-target"></div>
			<div class="problem-text">
				<h2>DO YOU HATE HAVING YOUR PICTURE TAKEN?</h2>
				<p>LACK OF CONFIDENCE, FEAR OF FAILURE, AND FEELING THAT YOU AREN'T PHOTOGENIC, PREVENT YOU FROM SHOWING YOUR TRUE SELF</p>
				<p class="accent">A <span class="highlight">PROFESSIONAL HEADSHOT</span> EXPERIENCE CAN CHANGE EVERYTHING</p>
			</div>
		</div>
	</section>

</MainLayout>

<style is:global>
	#problem {
		min-height: 100vh;
		display: flex;
		align-items: center;
		justify-content: center;
	}

	.problem-content {
		display: flex;
		flex-direction: column;
		align-items: center;
		gap: 4rem;
	}

	.showcase-target {
		width: 1200px;
		height: 600px;
	}

	.problem-text {
		text-align: center;
		max-width: 800px;
		color:var(--drkclr);
		opacity: 0;
		transform: translateY(50px);
	}

	.problem-text h2 {
		font-size: 32px;
		font-weight: 700;
		text-transform: uppercase;
		margin-bottom: 1.5rem;
	}

	.problem-text p {
		font-size: 18px;
		line-height: 1.6;
		margin-bottom: 1rem;
	}

	.problem-text .accent {
		font-size: 20px;
		font-weight: 700;
	}

	.problem-text .highlight {
		color: #03a9f4;
	}

	/* Triptych styles */
	.triptych-container {
		display: flex;
		width: 100%;
		height: 100%;
		gap: 0;
	}

	.triptych-panel {
		flex: 1;
		position: relative;
		overflow: hidden;
	}

	.triptych-panel.panel-left {
		clip-path: url(#clip-left);
	}

	.triptych-panel.panel-center {
		clip-path: url(#clip-center);
		margin-left: -4%;
		margin-right: -4%;
		z-index: 1;
	}

	.triptych-panel.panel-right {
		clip-path: url(#clip-right);
	}

	.diagonal-img {
		width: 100%;
		height: 100%;
		object-fit: cover;
	}

	.triptych-panel.panel-right .diagonal-img {
		object-position: 20%;
	}

	.panel-overlay {
		position: absolute;
		top: 0;
		left: 0;
		width: 100%;
		height: 100%;
		background: rgba(0, 0, 0, 0.5);
		z-index: 1;
	}

	/* GPU Acceleration */
	.showcase-container {
		will-change: transform;
		transform: translate3d(0, 0, 0);
	}

	.triptych-panel {
		will-change: clip-path, opacity;
	}

	.problem-text {
		will-change: transform, opacity;
	}
</style>

<script>
	import gsap from 'gsap';
	import { ScrollTrigger } from 'gsap/ScrollTrigger';

	gsap.registerPlugin(ScrollTrigger);

	document.addEventListener('astro:page-load', () => {
		setupShowcaseTravel();
	});

	function setupShowcaseTravel() {
		const showcaseContainer = document.querySelector('.showcase-container') as HTMLElement;
		const heroSection = document.querySelector('#heroExperience');
		const problemSection = document.querySelector('#problem');
		const showcaseTarget = document.querySelector('.showcase-target');
		const heroImagesElements = document.querySelectorAll('.hero-image') as NodeListOf<HTMLElement>;
		const imageLayerForeground = document.querySelector('.image-layer.foreground') as HTMLElement;
		const imageDepthLayers = document.querySelector('.image-depth-layers') as HTMLElement;
		const triptychContent = document.getElementById('triptych-content');
		const problemText = document.querySelector('.problem-text') as HTMLElement;

		if (!showcaseContainer || !heroSection || !problemSection || !showcaseTarget || !heroImagesElements.length || !imageLayerForeground || !imageDepthLayers || !triptychContent || !problemText) {
			console.warn('Showcase travel elements not found');
			return;
		}

		// PRE-INSERT triptych into the image foreground layer (same level as hero images)
		const triptychClone = triptychContent.cloneNode(true) as HTMLElement;
		triptychClone.removeAttribute('id');
		triptychClone.style.display = 'block';
		triptychClone.style.position = 'absolute';
		triptychClone.style.top = '0';
		triptychClone.style.left = '0';
		triptychClone.style.width = '100%';
		triptychClone.style.height = '100%';
		triptychClone.style.opacity = '0';
		triptychClone.style.pointerEvents = 'none';
		triptychClone.classList.add('triptych-layer');
		imageLayerForeground.appendChild(triptychClone);

		// Main timeline for container movement
		const tl = gsap.timeline({
			scrollTrigger: {
				trigger: heroSection,
				start: 'top top',
				endTrigger: problemSection,
				end: 'center center',
				scrub: 1,
				immediateRender: false,
				onUpdate: (self: any) => {
					// Disable showcaseFloat when scrolling
					if (self.progress > 0) {
						showcaseContainer.style.animation = 'none';
					} else {
						showcaseContainer.style.animation = 'showcaseFloat 12s ease-in-out infinite';
					}
				}
			}
		});

		// Container movement (duration: 1)
		// Calculate initial positions once to avoid recalculating during animation
		const initialContainerRect = showcaseContainer.getBoundingClientRect();
		const initialTargetRect = showcaseTarget.getBoundingClientRect();

		const targetCenterX = initialTargetRect.left + (initialTargetRect.width / 2);
		const targetCenterY = initialTargetRect.top + (initialTargetRect.height / 2);
		const containerCenterX = initialContainerRect.left + (initialContainerRect.width / 2);
		const containerCenterY = initialContainerRect.top + (initialContainerRect.height / 2);

		const deltaX = targetCenterX - containerCenterX;
		const deltaY = targetCenterY - containerCenterY;

		// Calculate width change offset to keep centered
		const initialWidth = initialContainerRect.width;
		const targetWidth = 1200;
		const widthDifference = (targetWidth - initialWidth) / 2;

		tl.to(showcaseContainer, {
			x: deltaX - widthDifference,
			y: deltaY,
			z: 0,
			rotationX: 0,
			rotationY: 0,
			force3D: true,
			duration: 1,
			ease: 'power2.inOut'
		}, 0);

		// Animate container width by animating the image-depth-layers
		tl.to(imageDepthLayers, {
			width: targetWidth,
			duration: 1,
			ease: 'power2.inOut'
		}, 0);

		// Fade out hero images at 90% of movement (position: 0.9)
		tl.to(heroImagesElements, {
			opacity: 0,
			force3D: true,
			duration: 0.1,
			ease: 'none'
		}, 0.9);

		// Staggered panel reveals at 90% of movement (position: 0.9)
		const triptychPanels = triptychClone.querySelectorAll('.triptych-panel');
		tl.to(triptychClone, {
			opacity: 1,
			force3D: true,
			duration: 0.01,
			ease: 'none'
		}, 0.9);

		tl.fromTo(triptychPanels,
			{
				clipPath: 'inset(0 100% 0 0)'
			},
			{
				clipPath: 'inset(0 0% 0 0)',
				force3D: true,
				duration: 0.08,
				stagger: 0.01,
				ease: 'power2.out'
			},
		0.9);

		// Slide up problem text at 95% of movement (position: 0.95)
		tl.to(problemText, {
			opacity: 1,
			y: 0,
			force3D: true,
			duration: 0.05,
			ease: 'power2.out'
		}, 0.95);


		// Refresh ScrollTrigger to handle initial scroll position
		ScrollTrigger.refresh();

		console.log('Showcase travel animation initialized');
	}
</script>
