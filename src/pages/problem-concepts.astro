---
import MainLayout from '../layouts/MainLayout.astro';
import { Image } from 'astro:assets';

// Import problem section images - Color versions
import image0029 from '../assets/images/problem/Headshot_20250917_Sonya Lilienstein_Richard Waine_Lancaster_PA_0029 (horizontal) - compressed.jpg';
import image0056 from '../assets/images/problem/Headshot_20250917_Sonya Lilienstein_Richard Waine_Lancaster_PA_0056 (horizontal) - compressed.jpg';
import image0079 from '../assets/images/problem/Headshot_20250917_Sonya Lilienstein_Richard Waine_Lancaster_PA_0079 (horizontal) - compressed.jpg';
import image0090 from '../assets/images/problem/Headshot_20250917_Sonya Lilienstein_Richard Waine_Lancaster_PA_0090 (horizontal) - compressed.jpg';

// Import problem section images - B&W versions
import imageBW0029 from '../assets/images/problem/Headshot_20250917_Sonya Lilienstein_Richard Waine_Lancaster_PA_0029 (horizontal  - B&W) - compressed.jpg';
import imageBW0056 from '../assets/images/problem/Headshot_20250917_Sonya Lilienstein_Richard Waine_Lancaster_PA_0056 (horizontal - B&W) - compressed.jpg';
import imageBW0079 from '../assets/images/problem/Headshot_20250917_Sonya Lilienstein_Richard Waine_Lancaster_PA_0079 (horizontal - B&W) - compressed.jpg';
import imageBW0090 from '../assets/images/problem/Headshot_20250917_Sonya Lilienstein_Richard Waine_Lancaster_PA_0090 (horizontal - B&W) - compressed.jpg';
---

<MainLayout title="Problem Section Concepts">

<!-- CONCEPT: 50/50 Split -->
<section class="scroll-concept" id="concept-1" style="background: #f5f5f5;">
    <!-- <div class="concept-label">CONCEPT: 50/50 SPLIT - TEXT + ONE IMAGE</div> -->
    <div class="scroll-container" id="scroll-container-1">
        <div class="scroll-panel text-panel" id="text-panel-1">
            <div class="text-content">
                <h2 class="text-1" id="paragraph-1">DO YOU HATE HAVING YOUR PICTURE TAKEN?</h2>
                <p class="text-2" id="paragraph-2">LACK OF CONFIDENCE, FEAR OF FAILURE, AND FEELING THAT YOU AREN'T PHOTOGENIC, PREVENT YOU FROM SHOWING YOUR TRUE SELF</p>
                <p class="text-3 accent" id="paragraph-3">A PROFESSIONAL HEADSHOT EXPERIENCE CAN CHANGE EVERYTHING</p>
            </div>
        </div>
        <div class="scroll-panel image-panel" id="image-panel-1">
            <div class="image-wrapper">
                <Image src={image0090} alt="Uncertain expression" id="image-1" class="panel-image" />
                <Image src={image0056} alt="Dread expression" id="image-2" class="panel-image" />
                <Image src={image0079} alt="Confident expression" id="image-3" class="panel-image" />
            </div>
        </div>
    </div>
</section>

</MainLayout>

<style is:global>
    /* Prevent page scrolling during animation */
    body:has(.scroll-concept) {
        overflow: hidden;
        height: 100vh;
        overscroll-behavior: none;
    }

    html:has(.scroll-concept) {
        overflow: hidden;
        height: 100vh;
        overscroll-behavior: none;
    }

    /* Scroll Concept Sections */
    section.scroll-concept {
        height: calc(100vh - var(--header-height));
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        position: relative;
        padding: 0;
        padding-block: 0;
        margin: 0;
    }

    .concept-label {
        position: absolute;
        top: 1rem;
        left: 1rem;
        background: #03a9f4;
        color: white;
        padding: 0.5rem 1rem;
        font-size: 14px;
        font-weight: 700;
        letter-spacing: 0.1em;
        z-index: 100;
        
    }

    /* Scroll Container */
    .scroll-container {
        width: 100%;
        max-width: 1600px;
        height: 60vh;
        display: flex;

        gap: 0;
        margin: 0;
        padding: 0;
    }

    /* Scroll Panels */
    .scroll-panel {
        height: 60vh;
        overflow: hidden;
    }

    /* Text Panel */
    .text-panel {
        background: #121212;
        display: flex;
        align-items: center;
        justify-content: center;
        flex: 1;
       
    }

    .text-content {
        padding: 3rem;
        text-align: center;
        color: white;
        position: relative;
        height: 100%;
        width: 100%;
        max-width: 800px;
        margin: 0 auto;
    }

    /* All paragraphs positioned absolutely in the same spot */
    #paragraph-1,
    #paragraph-2,
    #paragraph-3 {
        position: absolute;
        top: 50%;
        left: 3rem;
        right: 3rem;
        margin: 0;
        will-change: opacity, transform;
    }

    /* Paragraph 1 - starts large and centered */
    #paragraph-1 {
        font-size: 32px;
        font-weight: 700;
        text-transform: uppercase;
        line-height: 1.3;
    }

    /* Paragraphs 2 & 3 - start hidden */
    #paragraph-2,
    #paragraph-3 {
        font-size: 20px;
        line-height: 1.7;
    }

    #paragraph-3 {
        color: #03a9f4;
        font-weight: 700;
        font-size: 22px;
    }

    /* Image Panels */
    .image-panel {
        flex: 0;
        overflow: hidden;
        position: relative;
    }

    .image-wrapper {
        width: 100%;
        height: 100%;
        position: relative;
    }

    .panel-image {
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: block;
        position: absolute;
        top: 0;
        left: 0;
    }

    /* Option 2 specific styles */
    .swap-image-after {
        position: absolute;
        top: 0;
        left: 0;
        opacity: 0;
        flex: 0 0 25%;
    }

    /* Option 3 specific styles */
    .hero-image {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        opacity: 0;
    }

    /* Responsive */
    @media (max-width: 1024px) {
        .scroll-container {
            flex-direction: column;
        }

        .text-content {
            padding: 2rem;
        }

        .text-content h2 {
            font-size: 24px;
        }

        .text-content p {
            font-size: 18px;
        }
    }
</style>

<script>
import gsap from 'gsap';

let currentStage = 0;
let isTransitioning = false;

document.addEventListener('DOMContentLoaded', () => {
    const textPanel = document.querySelector('#text-panel-1');
    const imagePanel = document.querySelector('#image-panel-1');
    const textContent = document.querySelector('.text-content');
    const p1 = document.querySelector('#paragraph-1');
    const p2 = document.querySelector('#paragraph-2');
    const p3 = document.querySelector('#paragraph-3');
    const img1 = document.querySelector('#image-1');
    const img2 = document.querySelector('#image-2');
    const img3 = document.querySelector('#image-3');

    // Set initial states - use yPercent to maintain centering
    gsap.set(p1, { scale: 2, yPercent: -50 }); // Start at 2x scale, centered
    gsap.set(p2, { opacity: 0, yPercent: -50, y: 50 });
    gsap.set(p3, { opacity: 0, yPercent: -50, y: 50 });
    gsap.set([img1, img2, img3], { opacity: 0 });

    function transitionToStage(targetStage: number) {
        if (targetStage === currentStage || targetStage < 0 || targetStage > 3) return;

        isTransitioning = true;
        const tl = gsap.timeline({
            onComplete: () => {
                currentStage = targetStage;
                // Add cooldown after transition completes
                setTimeout(() => {
                    isTransitioning = false;
                }, 300);
            }
        });

        // 0 → 1
        if (currentStage === 0 && targetStage === 1) {
            tl.to(p1, { scale: 1, duration: 0.6, ease: 'power2.out' }, 0)
              .to(textPanel, { flex: 0.5, duration: 0.6, ease: 'power2.out' }, 0)
              .to(imagePanel, { flex: 0.5, duration: 0.6, ease: 'power2.out' }, 0)
              .to(img1, { opacity: 1, duration: 0.8, ease: 'power2.inOut' }, 0);
        }
        // 1 → 0
        else if (currentStage === 1 && targetStage === 0) {
            tl.to(img1, { opacity: 0, duration: 0.3, ease: 'power2.in' }, 0)
              .to(p1, { scale: 2, duration: 0.5, ease: 'power2.in' }, 0.1)
              .to(textPanel, { flex: 1, duration: 0.5, ease: 'power2.in' }, 0.1)
              .to(imagePanel, { flex: 0, duration: 0.5, ease: 'power2.in' }, 0.1);
        }
        // 1 → 2
        else if (currentStage === 1 && targetStage === 2) {
            tl.to(p1, { opacity: 0, duration: 0.4, ease: 'power2.inOut' }, 0)
              .to(img1, { opacity: 0, duration: 0.3, ease: 'power2.inOut' }, 0)
              .to(img2, { opacity: 1, duration: 0.3, ease: 'power2.inOut' }, 0.2)
              .to(p2, { opacity: 1, y: 0, duration: 0.5, ease: 'power2.out' }, 0.2);
        }
        // 2 → 1
        else if (currentStage === 2 && targetStage === 1) {
            tl.to(p2, { opacity: 0, y: 50, duration: 0.4, ease: 'power2.in' }, 0)
              .to(img2, { opacity: 0, duration: 0.3, ease: 'power2.inOut' }, 0)
              .to(img1, { opacity: 1, duration: 0.3, ease: 'power2.inOut' }, 0.2)
              .to(p1, { opacity: 1, duration: 0.4, ease: 'power2.inOut' }, 0.2);
        }
        // 2 → 3
        else if (currentStage === 2 && targetStage === 3) {
            tl.to(p2, { opacity: 0, y: 50, duration: 0.4, ease: 'power2.in' }, 0)
              .to(img2, { opacity: 0, duration: 0.3, ease: 'power2.inOut' }, 0)
              .to(img3, { opacity: 1, duration: 0.3, ease: 'power2.inOut' }, 0.2)
              .to(p3, { opacity: 1, y: 0, duration: 0.5, ease: 'power2.out' }, 0.2);
        }
        // 3 → 2
        else if (currentStage === 3 && targetStage === 2) {
            tl.to(p3, { opacity: 0, y: 50, duration: 0.4, ease: 'power2.in' }, 0)
              .to(img3, { opacity: 0, duration: 0.3, ease: 'power2.inOut' }, 0)
              .to(img2, { opacity: 1, duration: 0.3, ease: 'power2.inOut' }, 0.2)
              .to(p2, { opacity: 1, y: 0, duration: 0.5, ease: 'power2.out' }, 0.2);
        }
    }

    let scrollAccumulator = 0;
    const scrollThreshold = 200; // Amount of scroll needed to trigger transition
    let resetTimeout: number;

    window.addEventListener('wheel', (e) => {
        // Block all scroll accumulation during transitions
        if (isTransitioning) {
            e.preventDefault();
            scrollAccumulator = 0; // Keep resetting during transition
            return;
        }

        // Only prevent default if we're in the active range
        if ((e.deltaY > 0 && currentStage < 3) || (e.deltaY < 0 && currentStage > 0)) {
            e.preventDefault();
        }

        // Add to accumulator
        scrollAccumulator += e.deltaY;

        // Reset accumulator if user stops scrolling for a moment
        clearTimeout(resetTimeout);
        resetTimeout = window.setTimeout(() => {
            scrollAccumulator = 0;
        }, 200);

        // Trigger transition once threshold is reached
        if (Math.abs(scrollAccumulator) >= scrollThreshold) {
            if (scrollAccumulator > 0 && currentStage < 3) {
                scrollAccumulator = 0;
                transitionToStage(currentStage + 1);
            } else if (scrollAccumulator < 0 && currentStage > 0) {
                scrollAccumulator = 0;
                transitionToStage(currentStage - 1);
            } else {
                scrollAccumulator = 0;
            }
        }
    }, { passive: false });
});
</script>
